#include "sha512tests.h"

#include <QtTest>
#include <QDebug>

extern "C" {
#include "otpimpl/sha2.h"
}

#include "testutils.h"

void Sha512Tests::sha512ImplTests()
{
    unsigned char abctest[] = { 0xdd, 0xaf, 0x35, 0xa1, 0x93, 0x61, 0x7a, 0xba, 0xcc, 0x41, 0x73, 0x49, 0xae, 0x20, 0x41, 0x31, 0x12, 0xe6, 0xfa, 0x4e, 0x89, 0xa9, 0x7e, 0xa2, 0x0a, 0x9e, 0xee, 0xe6, 0x4b, 0x55, 0xd3, 0x9a, 0x21, 0x92, 0x99, 0x2a, 0x27, 0x4f, 0xc1, 0xa8, 0x36, 0xba, 0x3c, 0x23, 0xa3, 0xfe, 0xeb, 0xbd, 0x45, 0x4d, 0x44, 0x23, 0x64, 0x3c, 0xe8, 0x0e, 0x2a, 0x9a, 0xc9, 0x4f, 0xa5, 0x4c, 0xa4, 0x9f };
    unsigned char result[64];
    sha512_ctx ctx;

    // Test string is "abc".
    sha512_init(&ctx);
    sha512_update(&ctx, (unsigned char *)"abc", 3);
    sha512_final(&ctx, (unsigned char *)&result);

    qDebug("Expected   : %s", TestUtils::binaryToString(abctest, 64).c_str());
    qDebug("Calculated : %s", TestUtils::binaryToString(result, 64).c_str());

    QVERIFY(memcmp(&result, &abctest, 64) == 0);
}
